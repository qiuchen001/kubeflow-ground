# PIPELINE DEFINITION
# Name: dynamic-configuration-data-preprocessing-model-training
# Description: 动态生成的工作流：Dynamic Configuration - Data Preprocessing + Model Training
components:
  comp-preprocess:
    executorLabel: exec-preprocess
    inputDefinitions:
      parameters:
        minio_endpoint:
          parameterType: STRING
        raw_data:
          parameterType: STRING
  comp-train:
    executorLabel: exec-train
    inputDefinitions:
      parameters:
        minio_endpoint:
          parameterType: STRING
        train_data:
          parameterType: STRING
defaultPipelineRoot: s3://kubeflow-pipeline/pipeline-root/
deploymentSpec:
  executors:
    exec-preprocess:
      container:
        args:
        - --raw-data
        - '{{$.inputs.parameters[''raw_data'']}}'
        - --minio-endpoint
        - '{{$.inputs.parameters[''minio_endpoint'']}}'
        command:
        - python
        - /app/mnist_preprocess.py
        image: qiuchen123/kfp-mlops:mnist-prep-v1
    exec-train:
      container:
        args:
        - --epochs
        - '10'
        - --learning-rate
        - '0.001'
        - --train-data
        - '{{$.inputs.parameters[''train_data'']}}'
        - --minio-endpoint
        - '{{$.inputs.parameters[''minio_endpoint'']}}'
        command:
        - python
        - /app/mnist_train.py
        image: qiuchen123/kfp-mlops:mnist-train-v1
pipelineInfo:
  description: "\u52A8\u6001\u751F\u6210\u7684\u5DE5\u4F5C\u6D41\uFF1ADynamic Configuration\
    \ - Data Preprocessing + Model Training"
  displayName: Dynamic Configuration - Data Preprocessing + Model Training
  name: dynamic-configuration-data-preprocessing-model-training
root:
  dag:
    tasks:
      preprocess:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-preprocess
        inputs:
          parameters:
            minio_endpoint:
              runtimeValue:
                constant: minio-service.kubeflow:9000
            raw_data:
              runtimeValue:
                constant: s3://kubeflow-pipeline/raw/train_data.csv
        taskInfo:
          name: preprocess
      train:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-train
        dependentTasks:
        - preprocess
        inputs:
          parameters:
            minio_endpoint:
              runtimeValue:
                constant: minio-service.kubeflow:9000
            train_data:
              runtimeValue:
                constant: s3://kubeflow-pipeline/processed/clean_data.csv
        taskInfo:
          name: train
schemaVersion: 2.1.0
sdkVersion: kfp-2.15.1
