# PIPELINE DEFINITION
# Name: dynamic-configuration-data-preprocessing-model-training
# Description: 动态生成的工作流：Dynamic Configuration - Data Preprocessing + Model Training
components:
  comp-preprocess:
    executorLabel: exec-preprocess
    inputDefinitions:
      parameters:
        raw_data:
          parameterType: STRING
    outputDefinitions:
      parameters:
        clean_data:
          parameterType: STRING
  comp-train:
    executorLabel: exec-train
    inputDefinitions:
      parameters:
        train_data:
          parameterType: STRING
    outputDefinitions:
      parameters:
        trained_model:
          parameterType: STRING
defaultPipelineRoot: s3://kubeflow-pipeline/pipeline-root/
deploymentSpec:
  executors:
    exec-preprocess:
      container:
        args:
        - --output-data-dir
        - '{{$.outputs.parameters[''clean_data''].output_file}}'
        command:
        - python
        - /app/mnist_preprocess.py
        image: qiuchen123/kfp-mlops:mnist-prep-v1
    exec-train:
      container:
        args:
        - --epochs
        - '10'
        - --lr
        - '0.001'
        - --input-dir
        - '{{$.inputs.parameters[''train_data'']}}'
        - --output-model-dir
        - '{{$.outputs.parameters[''trained_model''].output_file}}'
        command:
        - python
        - /app/mnist_train.py
        image: qiuchen123/kfp-mlops:mnist-train-v1
pipelineInfo:
  description: "\u52A8\u6001\u751F\u6210\u7684\u5DE5\u4F5C\u6D41\uFF1ADynamic Configuration\
    \ - Data Preprocessing + Model Training"
  displayName: Dynamic Configuration - Data Preprocessing + Model Training
  name: dynamic-configuration-data-preprocessing-model-training
root:
  dag:
    tasks:
      preprocess:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-preprocess
        inputs:
          parameters:
            raw_data:
              runtimeValue:
                constant: s3://kubeflow-pipeline/raw/train_data.csv
        taskInfo:
          name: preprocess
      train:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-train
        dependentTasks:
        - preprocess
        inputs:
          parameters:
            train_data:
              runtimeValue:
                constant: s3://kubeflow-pipeline/processed/clean_data.csv
        taskInfo:
          name: train
schemaVersion: 2.1.0
sdkVersion: kfp-2.15.1
